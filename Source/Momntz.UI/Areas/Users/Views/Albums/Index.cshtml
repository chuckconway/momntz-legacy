@using Momntz.UI.Areas.Users.Models
@model GroupView

@{
    Layout = "~/Views/Shared/_MasonryMaster.cshtml";
}

@section Head
{ 
    <script type="text/javascript">
        function getItems(getData) {
            var last = $('input#lastalbumid');

            function executeOnData(data) {

                if (data != null && data.length > 0) {
                    var item = data[data.length - 1];
                    last.val(item.Id);

                    getData(data);
                }
            }

            $.post('/api/albums/albumscroll?albumid=' + last.val() + '&username=@Model.Username', executeOnData);
        }

        function getTemplate() { return $("#album-template").html(); }

        $(function () {
            
            $("a#triggerAlbumAdd").leanModal({ closeButton: "button#cancelAlbum" });
            $("button#createalbum").click(function () {

                var name = $("input#albumName");
                var story = $("textarea#albumStory");

                var c = $('#container');

                $.post('/api/albums/new', { name: name.val(), story: story.val() }, function (data){prependTiles(data, c);});
                
                $("#lean_overlay").fadeOut(200);
                $('#addAlbum').css({ 'display': 'none' });

                name.val('');
                story.val('');
            });
        });

    </script>
}


@if (Model.Items.Count > 0)
{
    <input type="hidden" id="lastalbumid" value="@Model.Items.Last().Id" />
}

<div id="addAlbum" class="modal" style="display: none;" >
    <div class="header" >
        <h2>Create an Album</h2>
        <span class="required"><span class="required fontsize22">*</span> required.</span>
    </div>
    <p>
        <label>Name<span class="required fontsize22">*</span></label>
        <input type="text" id="albumName" />
    </p>
    <p>
        <label>Story</label>
        <textarea id="albumStory" ></textarea>
    </p>
    <p>
        <button id="createalbum" class="action" >Create Album</button>
        <button id="cancelAlbum" class="action">Cancel</button>
    </p>
</div>

@section Navigation
{
    @{ Html.RenderPartial("/Views/Shared/_MasonryNavigationPartial.cshtml", new NavigationModel{ SignedUser = Model, Visibility = NavigationVisiblity.AddAlbum}); }
}

@{ Html.RenderPartial("_MasonryGroupedItemsPartial", Model); }