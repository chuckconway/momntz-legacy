@using Momntz.UI.Areas.Users.Models
@model Momntz.UI.Areas.Users.Models.ContentWithTitleView

@{
    Layout = "/Views/Shared/_MasonryMaster.cshtml";
}

@section BottomScript
{
    <style>
        h1 {text-align: center;margin-top: 0;font-size: 20px;clear: both;margin-bottom: 15px;}
    </style>

    <script type="text/javascript">

        function getItems(getData) {
            var last = $('input#lastmomentid');
            var albumId = $('input#albumId');

            function executeOnData(data) {

                var item = data[data.length - 1];
                if (item !== undefined) {
                    last.val(item.Id);
                }
                
                getData(data);
            }

            $.post('/api/scroll/TileScroll?albumid=' + albumId.val() + '&momentoid=' + last.val() + '&username=@Model.Username', executeOnData);
        }

        function getTemplate() {
            return $("#entry-template").html();
        }

        $(function() {
            Dropzone.options.upload = {
                init: function() {
                    this.on("sending", function(file, xhr, formData) {
                        var albumId = $("input#albumId").val();
                        formData.append("albumid", albumId);
                    });

                    this.on("complete", function(file) {
                        var albumId = $("input#albumId").val();
                        var c = $('#container');
                        $.post('/api/momentomedia/GetNewlyAddedAlbumPhoto?filename=' + file.name + '&size=' + file.size + '&albumid=' + albumId, function (data) {
                            
                            var last = $('input#lastmomentid');
                            var item = data[data.length - 1];
                            last.val(item.Id);

                            prependTiles(data, c);
                        });
                    });
                }
            };
        });

    </script>
}

@if (Model.Items.Count > 0)
{
    <input type="hidden" id="lastmomentid" value="@Model.Items.Last().Id" />
    <input type="hidden" id="lastimage" value="" />
}

<input type="hidden" id="albumId" value="@Model.Id" />

@section Navigation
{
    @{ Html.RenderPartial("/Views/Shared/_MasonryNavigationPartial.cshtml", new NavigationModel {SignedUser = Model, Visibility = NavigationVisiblity.AddImage}); }
}


@section ContentTitle{
    <h1 style="margin-top: 60px;">@Model.Title</h1>
}



@{ Html.RenderPartial("_MasonryPartial", Model.Items); }