@using Momntz.UI.Areas.Users.Models
@model UserView 

@{
    Layout = "~/Views/Shared/_MasonryMaster.cshtml";
}

@section Head
{
    <script type="text/javascript">

        function getItems(addTiles) {
            var last = $('input#lastmomentid');

            $.post('/api/momento/userscroll?username=@Model.Username&momentoid=' + last.val(), function(data) {


                var item = data[data.length - 1];
                if (item !== undefined) {
                    last.val(item.Id);
                }

                addTiles(data);


            });
        }

        function getTemplate() {
            return $("#entry-template").html();
        }
    </script>
}

@if (Model.Items.Count > 0)
{
    <input type="hidden" id="lastmomentid" value="@Model.Items.Last().Id" />
}

@section PageBottom
{
                <script type="text/javascript">
                    $(function () {
                        Dropzone.options.upload = {
                            init: function () {
                                this.on("complete", function (file) {
                                    var c = $('#container');
                                    $.post('/api/momentomedia/GetNewlyAddedPhoto?filename=' + file.name + '&size=' + file.size, function (data) {

                                        var last = $('input#lastmomentid');
                                        var item = data[data.length - 1];
                                        last.val(item.Id);

                                        prependTiles(data, c);
                                    });
                                });
                            }
                        };
                    });

    </script>
}

@section Navigation
{
    @{ Html.RenderPartial("/Views/Shared/_MasonryNavigationPartial.cshtml", new NavigationModel {SignedUser = Model, Visibility = NavigationVisiblity.AddImage}); }
}

@{ Html.RenderPartial("_MasonryPartial", Model.Items); }